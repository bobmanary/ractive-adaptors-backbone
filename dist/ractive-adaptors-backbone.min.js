(function(e,n){typeof exports==="object"&&typeof module!=="undefined"?module.exports=n():typeof define==="function"&&define.amd?define(n):e.Ractive.adaptors.Backbone=n()})(this,function(){"use strict";var e="_ractiveAdaptorsBackboneLock";function n(n){n[e]=(n[e]||0)+1;return function t(){n[e]-=1;if(!n[e]){delete n[e]}}}function t(n){return!!n[e]}var o={Backbone:typeof window!=="undefined"&&window.Backbone||null,filter:function e(n){if(!o.Backbone){throw new Error("Could not find Backbone. You must do `adaptor.Backbone = Backbone` - see https://github.com/ractivejs/ractive-adaptors-backbone#installation for more information")}return n instanceof o.Backbone.Model||n instanceof o.Backbone.Collection},wrap:function e(n,t,r,c){if(t instanceof o.Backbone.Model){return new a(n,t,r,c)}return new i(n,t,r,c)}};function a(e,t,o,a){this.value=t;t.on("change",this.modelChangeHandler=function(){var o=n(t);e.set(a(t.changed));if(t.changedComputeds){e.set(a(t.changedComputeds))}o()})}a.prototype={teardown:function e(){this.value.off("change",this.modelChangeHandler)},get:function e(){return this.value.toJSON({computed:true})},set:function e(n,o){if(!t(this.value)&&n.indexOf(".")===-1){this.value.set(n,o)}},reset:function e(n){if(n instanceof o.Backbone.Model||!(n instanceof Object)){return false}this.value.set(n)}};function i(e,t,o){this.value=t;t.on("add remove reset sort",this.changeHandler=function(){var a=n(t);e.set(o,t.models);a()})}i.prototype={teardown:function e(){this.value.off("add remove reset sort",this.changeHandler)},get:function e(){return this.value.models},reset:function e(n){if(t(this.value)){return}if(n instanceof o.Backbone.Collection||Object.prototype.toString.call(n)!=="[object Array]"){return false}this.value.reset(n)}};var r=o;return r});
